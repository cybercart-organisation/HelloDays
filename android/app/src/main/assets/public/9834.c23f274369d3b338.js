"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9834],{9834:(K,C,d)=>{d.r(C),d.d(C,{CalendarPage:()=>j});var f=d(467),c=d(9893),u=d(2200),b=d(9739),E=d(2615),e=d(3664),T=d(8490),k=d(9731),w=d(487),F=d(7650);const $=(r,l,n)=>({"event-birthday":r,"event-nameday":l,"event-both":n});function S(r,l){if(1&r&&(e.j41(0,"ion-col"),e.EFF(1),e.k0s()),2&r){const n=l.$implicit;e.R7$(),e.JRh(n)}}function N(r,l){if(1&r&&(e.j41(0,"div",14),e.EFF(1),e.k0s()),2&r){const n=l.$implicit;e.AVh("reminder-name",n.isReminder),e.R7$(),e.SpI(" ",n.title," ")}}function A(r,l){1&r&&(e.j41(0,"div",15),e.EFF(1," ... "),e.k0s())}function B(r,l){if(1&r){const n=e.RV6();e.j41(0,"ion-col",9),e.bIt("click",function(){const t=E.eBV(n).$implicit,o=e.XpG(2);return E.Njj(o.selectDate(t))}),e.j41(1,"div",10),e.EFF(2),e.k0s(),e.j41(3,"div",11),e.DNE(4,N,2,3,"div",12),e.nI1(5,"slice"),e.DNE(6,A,2,0,"div",13),e.k0s()()}if(2&r){const n=l.$implicit;e.AVh("today",null==n?null:n.isToday)("other-month",!(null!=n&&n.isCurrentMonth)),e.Y8G("ngClass",e.sMw(12,$,"birthday"===(null==n?null:n.eventType),"nameDay"===(null==n?null:n.eventType),"both"===(null==n?null:n.eventType))),e.R7$(2),e.JRh(null==n?null:n.date),e.R7$(2),e.Y8G("ngForOf",e.brH(5,8,null==n?null:n.events,0,2)),e.R7$(2),e.Y8G("ngIf",((null==n||null==n.events?null:n.events.length)??0)>2)}}function I(r,l){if(1&r&&(e.j41(0,"ion-row"),e.DNE(1,B,7,16,"ion-col",8),e.k0s()),2&r){const n=l.$implicit;e.R7$(),e.Y8G("ngForOf",n)}}function U(r,l){if(1&r&&(e.j41(0,"ion-item")(1,"ion-label")(2,"h2"),e.EFF(3),e.k0s()(),e.nrm(4,"ion-icon",16),e.k0s()),2&r){const n=l.$implicit;e.R7$(3),e.JRh(n.title),e.R7$(),e.Y8G("name","Birthday"===n.type?"gift-outline":"sparkles-outline")}}function x(r,l){if(1&r&&(e.j41(0,"ion-list")(1,"ion-list-header")(2,"ion-label"),e.EFF(3),e.nI1(4,"date"),e.k0s()(),e.DNE(5,U,5,2,"ion-item",6),e.k0s()),2&r){const n=e.XpG();e.R7$(3),e.JRh(e.i5U(4,2,n.selectedDate,"longDate")),e.R7$(2),e.Y8G("ngForOf",n.selectedDayEvents)}}let j=(()=>{var r;class l{constructor(a,t,o,i,_,s,g){this.dataService=a,this.nameDayService=t,this.actionSheetCtrl=o,this.modalCtrl=i,this.themeService=_,this.notificationService=s,this.toastCtrl=g,this.currentDate=new Date,this.daysOfWeek=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],this.calendarDays=[],this.eventsByDay=new Map,this.selectedDayEvents=[],this.selectedDate=null}ionViewWillEnter(){this.loadDataAndGenerateCalendar()}loadDataAndGenerateCalendar(){var a=this;return(0,f.A)(function*(){a.eventsByDay.clear();const t=yield a.dataService.getContacts(),o=a.mapRemindersToEvents(t),i=yield a.nameDayService.getAllNameDays();[...o,...a.mapAllNameDaysToEvents(i,t)].forEach(g=>{const D=new Date(g.date),h=`${D.getMonth()}-${D.getDate()}`,y=a.eventsByDay.get(h)||[];a.eventsByDay.set(h,[...y,g])}),a.generateCalendar()})()}generateCalendar(){const a=new Date(this.currentDate),t=a.getFullYear(),o=a.getMonth(),i=new Date(t,o,1),s=new Date(t,o+1,0).getDate(),g=i.getDay(),D=[];let h=[],y=1;for(let m=0;m<g;m++)h.push(null);for(;y<=s;){7===h.length&&(D.push(h),h=[]);const m=new Date(t,o,y),W=m.toDateString()===(new Date).toDateString(),G=`${m.getMonth()}-${m.getDate()}`,M=this.eventsByDay.get(G)||[],O=M.filter(v=>v.isReminder),P=O.some(v=>"Birthday"===v.type),R=O.some(v=>"Name Day"===v.type);let p=null;P&&R?p="both":P?p="birthday":R&&(p="nameDay"),h.push({date:y,isToday:W,isCurrentMonth:!0,eventType:p,fullDate:m,events:M}),y++}for(;h.length<7;)h.push(null);D.push(h),this.calendarDays=D}normalizeString(a){return a.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}mapRemindersToEvents(a){const t=[];return a.forEach(o=>{o.birthday&&t.push({title:`\u{1f382} ${o.firstName}`,type:"Birthday",date:new Date(o.birthday),isReminder:!0}),o.nameDays.forEach(i=>{t.push({title:`\u{1f389} ${o.firstName}`,type:"Name Day",date:new Date(i.date),isReminder:!0})})}),t}mapAllNameDaysToEvents(a,t){const o=new Set(t.flatMap(i=>i.nameDays.map(_=>{const s=new Date(_.date);return`${this.normalizeString(i.firstName)}-${s.getMonth()}-${s.getDate()}`})));return a.filter(i=>{const _=new Date(i.date),s=`${this.normalizeString(i.name)}-${_.getMonth()}-${_.getDate()}`;return!o.has(s)}).map(i=>({title:i.name,type:"Name Day",date:new Date(i.date),isReminder:!1}))}previousMonth(){this.currentDate.setMonth(this.currentDate.getMonth()-1),this.generateCalendar(),this.clearSelection()}nextMonth(){this.currentDate.setMonth(this.currentDate.getMonth()+1),this.generateCalendar(),this.clearSelection()}selectDate(a){var t=this;return(0,f.A)(function*(){if(!a)return;t.selectedDate=a.fullDate,t.selectedDayEvents=a.events.map(s=>s.isReminder?{...s,title:`${s.title.replace(/\ud83c\udf82 |\ud83c\udf89 /g,"")}'s ${s.type}`}:s);const i=a.events.filter(s=>!s.isReminder).map(s=>({text:`Create Reminder for ${s.title}`,handler:()=>t.openReminderForm({firstName:s.title,nameDayDate:a.fullDate.toISOString()})}));i.push({text:"Add New Reminder",handler:()=>t.openReminderForm({birthdayDate:a.fullDate.toISOString()})}),i.push({text:"Cancel",role:"cancel"}),yield(yield t.actionSheetCtrl.create({header:`Actions for ${a.fullDate.toLocaleDateString()}`,buttons:i})).present()})()}openReminderForm(a){var t=this;return(0,f.A)(function*(){const o=yield t.modalCtrl.create({component:b.w,componentProps:{initialData:a}});yield o.present();const{data:i}=yield o.onWillDismiss();if(i&&"save"===i.role){const _=yield t.dataService.addContact(i.contact);yield t.notificationService.scheduleReminders(_),t.presentToast("Reminder added successfully!"),t.loadDataAndGenerateCalendar()}})()}clearSelection(){this.selectedDate=null,this.selectedDayEvents=[]}presentToast(a){var t=this;return(0,f.A)(function*(){(yield t.toastCtrl.create({message:a,duration:2e3,position:"bottom"})).present()})()}static#e=r=()=>(this.\u0275fac=function(t){return new(t||l)(e.rXU(T.u),e.rXU(k.Z),e.rXU(c.GD),e.rXU(c.W3),e.rXU(w.F),e.rXU(F.J),e.rXU(c.K_))},this.\u0275cmp=e.VBU({type:l,selectors:[["app-calendar"]],decls:18,vars:7,consts:[[1,"calendar-header","ion-padding-horizontal"],["fill","clear",3,"click"],["slot","icon-only","name","chevron-back-outline"],["slot","icon-only","name","chevron-forward-outline"],[1,"calendar-grid"],[1,"week-header"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"today","other-month","ngClass","click",4,"ngFor","ngForOf"],[3,"click","ngClass"],[1,"day-number"],[1,"event-names-container"],["class","event-name",3,"reminder-name",4,"ngFor","ngForOf"],["class","event-name more-events",4,"ngIf"],[1,"event-name"],[1,"event-name","more-events"],["slot","start",3,"name"]],template:function(t,o){1&t&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Calendar"),e.k0s()()(),e.j41(4,"ion-content")(5,"div",0)(6,"ion-button",1),e.bIt("click",function(){return o.previousMonth()}),e.nrm(7,"ion-icon",2),e.k0s(),e.j41(8,"h2"),e.EFF(9),e.nI1(10,"date"),e.k0s(),e.j41(11,"ion-button",1),e.bIt("click",function(){return o.nextMonth()}),e.nrm(12,"ion-icon",3),e.k0s()(),e.j41(13,"ion-grid",4)(14,"ion-row",5),e.DNE(15,S,2,1,"ion-col",6),e.k0s(),e.DNE(16,I,2,1,"ion-row",6),e.k0s(),e.DNE(17,x,6,5,"ion-list",7),e.k0s()),2&t&&(e.R7$(9),e.JRh(e.i5U(10,4,o.currentDate,"MMMM yyyy")),e.R7$(6),e.Y8G("ngForOf",o.daysOfWeek),e.R7$(),e.Y8G("ngForOf",o.calendarDays),e.R7$(),e.Y8G("ngIf",o.selectedDayEvents.length>0))},dependencies:[c.bv,c.Jm,c.hU,c.W9,c.lO,c.eU,c.iq,c.uz,c.he,c.nf,c.AF,c.ln,c.BC,c.ai,u.MD,u.YU,u.Sq,u.bT,u.P9,u.vh],styles:[".calendar-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.calendar-grid[_ngcontent-%COMP%]{text-align:center}.week-header[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{font-weight:700}ion-col[_ngcontent-%COMP%]{padding:2px;height:60px;position:relative;border-radius:8px;transition:background-color .3s;display:flex;flex-direction:column;justify-content:flex-start}.day-number[_ngcontent-%COMP%]{font-size:.9em;margin-bottom:2px}.other-month[_ngcontent-%COMP%]{opacity:.3}.today[_ngcontent-%COMP%]   .day-number[_ngcontent-%COMP%]{background-color:var(--ion-color-primary);color:var(--ion-color-primary-contrast);border-radius:50%;width:22px;height:22px;line-height:22px;margin:0 auto 2px}.event-birthday[_ngcontent-%COMP%]{background-color:rgba(var(--ion-color-success-rgb),.2)}.event-nameday[_ngcontent-%COMP%]{background-color:rgba(var(--ion-color-tertiary-rgb),.2)}.event-both[_ngcontent-%COMP%]{background:linear-gradient(135deg,rgba(var(--ion-color-success-rgb),.2) 50%,rgba(var(--ion-color-tertiary-rgb),.2) 50%)}.event-names-container[_ngcontent-%COMP%]{flex-grow:1;overflow:hidden}.event-name[_ngcontent-%COMP%]{font-size:.6em;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding:0 2px}.reminder-name[_ngcontent-%COMP%]{font-weight:700;color:var(--ion-color-primary)}"]}))}return r(),l})()}}]);