"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4120],{4120:(T,h,d)=>{d.r(h),d.d(h,{RemindersPage:()=>M});var u=d(467),s=d(9893),v=d(9739),f=d(2200),p=d(2615),e=d(3664),E=d(8490),D=d(7650);function R(c,m){1&c&&(e.j41(0,"div",6),e.nrm(1,"ion-icon",7),e.j41(2,"h1"),e.EFF(3,"No Reminders Yet"),e.k0s(),e.j41(4,"p"),e.EFF(5,"Tap the '+' button to add your first reminder."),e.k0s()())}function y(c,m){if(1&c&&(e.j41(0,"p",16)(1,"b"),e.EFF(2),e.nI1(3,"date"),e.k0s()()),2&c){const l=e.XpG().$implicit;e.R7$(2),e.JRh(e.i5U(3,1,l.nextEventDate,"EEEE, MMM d"))}}function P(c,m){if(1&c){const l=e.RV6();e.j41(0,"ion-item-sliding")(1,"ion-item")(2,"ion-label")(3,"h2"),e.EFF(4),e.k0s(),e.DNE(5,y,4,4,"p",10),e.k0s(),e.nrm(6,"ion-icon",11),e.k0s(),e.j41(7,"ion-item-options",12)(8,"ion-item-option",4),e.bIt("click",function(){const n=p.eBV(l).$implicit,i=e.XpG(2);return p.Njj(i.openContactForm(n))}),e.nrm(9,"ion-icon",13),e.k0s(),e.j41(10,"ion-item-option",14),e.bIt("click",function(){const n=p.eBV(l).$implicit,i=e.XpG(2);return p.Njj(i.deleteReminder(n.id))}),e.nrm(11,"ion-icon",15),e.k0s()()()}if(2&c){const l=m.$implicit;e.R7$(4),e.Lme("",l.firstName," ",l.lastName),e.R7$(),e.Y8G("ngIf",l.nextEventDate),e.R7$(),e.Y8G("name",l.reminderEnabled?"notifications":"notifications-off")("color",l.reminderEnabled?"primary":"medium")}}function C(c,m){if(1&c&&(e.j41(0,"div")(1,"ion-item-divider",8)(2,"ion-label"),e.EFF(3),e.k0s()(),e.j41(4,"ion-list",9),e.DNE(5,P,12,5,"ion-item-sliding",2),e.k0s()()),2&c){const l=m.$implicit;e.R7$(3),e.JRh(l.name),e.R7$(),e.Y8G("inset",!0),e.R7$(),e.Y8G("ngForOf",l.reminders)}}let M=(()=>{var c;class m{constructor(t,n,i,o,r){this.dataService=t,this.notificationService=n,this.modalCtrl=i,this.alertCtrl=o,this.toastCtrl=r,this.groupedReminders=[]}ionViewWillEnter(){var t=this;return(0,u.A)(function*(){yield t.loadAndProcessReminders()})()}loadAndProcessReminders(){var t=this;return(0,u.A)(function*(){const i=(yield t.dataService.getContacts()).map(o=>({...o,nextEventDate:t.getNextEventDate(o)||void 0}));i.sort((o,r)=>o.nextEventDate&&r.nextEventDate?o.nextEventDate.getTime()-r.nextEventDate.getTime():o.nextEventDate?-1:r.nextEventDate?1:0),t.groupedReminders=t.groupReminders(i)})()}getNextEventDate(t){const n=new Date;n.setHours(0,0,0,0);const i=n.getFullYear();let o=null;const r=[];t.birthday&&r.push(new Date(t.birthday)),t.nameDays.forEach(a=>{r.push(new Date(a.date))});for(const a of r){let _=new Date(a);_.setFullYear(i),_<n&&_.setFullYear(i+1),(!o||_<o)&&(o=_)}return o}groupReminders(t){const n=new Map,i=new Date;i.setHours(0,0,0,0),t.forEach(a=>{const _=this.getGroupName(a.nextEventDate,i),g=n.get(_)||[];g.push(a),n.set(_,g)});const o=["Today","This Week","Next Week","This Month","Next Month","Later","No Upcoming Events"],r=[];for(const a of o)n.has(a)&&r.push({name:a,reminders:n.get(a)});return r}getGroupName(t,n){if(!t)return"No Upcoming Events";if(0===Math.round((t.getTime()-n.getTime())/864e5))return"Today";const r=new Date(n);r.setDate(n.getDate()+(6-n.getDay()));const a=new Date(r);a.setDate(r.getDate()+7);const _=new Date(n.getFullYear(),n.getMonth()+1,0),g=new Date(n.getFullYear(),n.getMonth()+2,0);return t<=r?"This Week":t<=a?"Next Week":t<=_?"This Month":t<=g?"Next Month":"Later"}openContactForm(){var t=this;return(0,u.A)(function*(n=null){const i=yield t.modalCtrl.create({component:v.w,componentProps:{contactToEdit:n}});yield i.present();const{data:o}=yield i.onWillDismiss();if(o&&"save"===o.role){const r=o.contact;if(r.id){const a=yield t.dataService.updateContact(r);yield t.notificationService.cancelReminders(a.id),yield t.notificationService.scheduleReminders(a),t.presentToast("Reminder updated successfully!")}else{const a=yield t.dataService.addContact(r);yield t.notificationService.scheduleReminders(a),t.presentToast("Reminder added successfully!")}yield t.loadAndProcessReminders()}}).apply(this,arguments)}deleteReminder(t){var n=this;return(0,u.A)(function*(){var o;yield(yield n.alertCtrl.create({header:"Confirm Delete",message:"Are you sure you want to delete this reminder?",buttons:[{text:"Cancel",role:"cancel"},{text:"Delete",handler:(o=(0,u.A)(function*(){yield n.notificationService.cancelReminders(t),yield n.dataService.deleteContact(t),yield n.loadAndProcessReminders(),n.presentToast("Reminder deleted.")}),function(){return o.apply(this,arguments)})}]})).present()})()}presentToast(t){var n=this;return(0,u.A)(function*(){(yield n.toastCtrl.create({message:t,duration:2e3,position:"bottom"})).present()})()}static#e=c=()=>(this.\u0275fac=function(n){return new(n||m)(e.rXU(E.u),e.rXU(D.J),e.rXU(s.W3),e.rXU(s.hG),e.rXU(s.K_))},this.\u0275cmp=e.VBU({type:m,selectors:[["app-reminders"]],decls:10,vars:3,consts:[[3,"fullscreen"],["class","empty-state",4,"ngIf"],[4,"ngFor","ngForOf"],["vertical","bottom","horizontal","end","slot","fixed"],[3,"click"],["name","add"],[1,"empty-state"],["name","list-circle-outline"],["sticky","true"],[3,"inset"],["class","next-event-date",4,"ngIf"],["slot","end",3,"name","color"],["side","end"],["slot","icon-only","name","pencil-outline"],["color","danger",3,"click"],["slot","icon-only","name","trash-outline"],[1,"next-event-date"]],template:function(n,i){1&n&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Reminders"),e.k0s()()(),e.j41(4,"ion-content",0),e.DNE(5,R,6,0,"div",1)(6,C,6,3,"div",2),e.j41(7,"ion-fab",3)(8,"ion-fab-button",4),e.bIt("click",function(){return i.openContactForm()}),e.nrm(9,"ion-icon",5),e.k0s()()()),2&n&&(e.R7$(4),e.Y8G("fullscreen",!0),e.R7$(),e.Y8G("ngIf",0===i.groupedReminders.length),e.R7$(),e.Y8G("ngForOf",i.groupedReminders))},dependencies:[s.bv,s.W9,s.Q8,s.YW,s.eU,s.iq,s.uz,s.Dg,s.LU,s.CE,s.A7,s.he,s.nf,s.BC,s.ai,f.MD,f.Sq,f.bT,f.vh],styles:["ion-item-divider[_ngcontent-%COMP%]{--background: var(--ion-color-light);--color: var(--ion-color-medium-shade);font-weight:700}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;height:100%;text-align:center;color:var(--ion-color-medium)}.empty-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:64px;margin-bottom:16px}.empty-state[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:22px;font-weight:700}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px}"]}))}return c(),m})()}}]);